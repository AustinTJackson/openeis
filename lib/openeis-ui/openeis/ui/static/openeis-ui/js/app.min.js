/*
Copyright (c) 2014, Battelle Memorial Institute
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

The views and conclusions contained in the software and documentation are those
of the authors and should not be interpreted as representing official policies,
either expressed or implied, of the FreeBSD Project.


This material was prepared as an account of work sponsored by an
agency of the United States Government.  Neither the United States
Government nor the United States Department of Energy, nor Battelle,
nor any of their employees, nor any jurisdiction or organization
that has cooperated in the development of these materials, makes
any warranty, express or implied, or assumes any legal liability
or responsibility for the accuracy, completeness, or usefulness or
any information, apparatus, product, software, or process disclosed,
or represents that its use would not infringe privately owned rights.

Reference herein to any specific commercial product, process, or
service by trade name, trademark, manufacturer, or otherwise does
not necessarily constitute or imply its endorsement, recommendation,
or favoring by the United States Government or any agency thereof,
or Battelle Memorial Institute. The views and opinions of authors
expressed herein do not necessarily state or reflect those of the
United States Government or any agency thereof.

PACIFIC NORTHWEST NATIONAL LABORATORY
operated by BATTELLE for the UNITED STATES DEPARTMENT OF ENERGY
under Contract DE-AC05-76RL01830
*/
function linePlotSVG(a,b,c){var d={top:20,right:20,bottom:30,left:50},e=920-d.left-d.right,f=300-d.top-d.bottom,g=d3.scale.linear().range([0,e]),h=d3.scale.linear().range([f,0]),i=d3.svg.axis().scale(g).orient("bottom"),j=d3.svg.axis().scale(h).orient("left"),k=d3.svg.line().x(function(a){return g(a.x)}).y(function(a){return h(a.y)}).interpolate("basis"),l=d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom),m=l.append("g").attr("transform","translate("+d.left+","+d.top+")");return g.domain(d3.extent(a,function(a){return a.x})),h.domain(d3.extent(a,function(a){return a.y})),m.append("g").attr("class","line-plot__axis line-plot__axis--x").attr("transform","translate(0,"+f+")").call(i),m.append("g").attr("class","line-plot__axis line-plot__axis--y").call(j).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(c),m.append("path").datum(a).attr("class","line-plot__line").attr("d",k),l[0]}function barChartSVG(a,b,c){var d={top:20,right:20,bottom:30,left:50},e=920-d.left-d.right,f=300-d.top-d.bottom,g=d3.scale.ordinal().rangeRoundBands([0,e],.1),h=d3.scale.linear().range([f,0]),i=d3.svg.axis().scale(g).orient("bottom"),j=d3.svg.axis().scale(h).orient("left"),k=d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom),l=k.append("g").attr("transform","translate("+d.left+","+d.top+")");return g.domain(a.map(function(a){return a.x})),h.domain([0,d3.max(a,function(a){return a.y})]),l.append("g").attr("class","bar-chart__axis bar-chart__axis--x").attr("transform","translate(0,"+f+")").call(i).text(b),l.append("g").attr("class","bar-chart__axis bar-chart__axis--y").call(j).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(c),l.selectAll("bar-chart__bar").data(a).enter().append("rect").attr("class","bar-chart__bar").attr("x",function(a){return g(a.x)}).attr("width",g.rangeBand()).attr("y",function(a){return h(a.y)}).attr("height",function(a){return f-h(a.y)}),k[0]}function scatterPlotSVG(a,b,c){{var d={top:20,right:20,bottom:30,left:40},e=920-d.left-d.right,f=300-d.top-d.bottom,g=function(a){return a.x},h=d3.scale.linear().range([0,e]),i=function(a){return h(g(a))},j=d3.svg.axis().scale(h).orient("bottom"),k=function(a){return a.y},l=d3.scale.linear().range([f,0]),m=function(a){return l(k(a))},n=d3.svg.axis().scale(l).orient("left"),o=function(){return 0},p=d3.scale.category10(),q=d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom),r=q.append("g").attr("transform","translate("+d.left+","+d.top+")");d3.select("body").append("div").attr("class","tooltip").style("opacity",0)}return h.domain([d3.min(a,g)-1,d3.max(a,g)+1]),l.domain([d3.min(a,k)-1,d3.max(a,k)+1]),r.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(j).append("text").attr("class","label").attr("x",e).attr("y",-6).style("text-anchor","end").text(b),r.append("g").attr("class","y axis").call(n).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(c),r.selectAll(".dot").data(a).enter().append("circle").attr("class","dot").attr("r",3.5).attr("cx",i).attr("cy",m).style("fill",function(a){return p(o(a))}),q[0]}function heatMapSVG(a){var b={top:50,right:0,bottom:100,left:100},c=960-b.left-b.right,d=1200-b.top-b.bottom,e=Math.floor(c/24),f=2*e,g=["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],h=d3.scale.quantile().domain(d3.extent(a,function(a){return a.z})).range(g),i=d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("width",c+b.left+b.right).attr("height",d+b.top+b.bottom),j=i.append("g").attr("transform","translate("+b.left+","+b.top+")"),k=(j.selectAll(".yLabel").data(d3.set(a.map(function(a){return a.y})).values()).enter().append("text").text(function(a){return a}).attr("x",0).attr("y",function(a,b){return b*e}).style("text-anchor","end").attr("transform","translate(-6,"+e/1.5+")").attr("class","yLabel"),j.selectAll(".xLabel").data(d3.set(a.map(function(a){return a.x})).values()).enter().append("text").text(function(a){return a}).attr("x",function(a,b){return b*e}).attr("y",0).style("text-anchor","middle").attr("transform","translate("+e/2+", -6)").attr("class","xLabel"),j.selectAll(".value").data(a).enter().append("rect").attr("x",function(a){return a.x*e}).attr("y",function(a){return(a.y.substr(a.y.lastIndexOf("-")+1)-1)*e}).attr("rx",4).attr("ry",4).attr("class","value bordered").attr("width",e).attr("height",e).style("fill",g[0]));k.transition().duration(1e3).style("fill",function(a){return h(a.z)}),k.append("title").text(function(a){return a.z});var l=j.selectAll(".legend").data([0].concat(h.quantiles()),function(a){return a}).enter().append("g").attr("class","legend");return l.append("rect").attr("x",function(a,b){return f*b}).attr("y",d).attr("width",f).attr("height",e/2).style("fill",function(a,b){return g[b]}),l.append("text").attr("class","mono").text(function(a){return"â‰¥ "+Math.round(a)}).attr("x",function(a,b){return f*b}).attr("y",d+e),i[0]}!function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.tv4=b()}(this,function(){function a(b,c){if(b===c)return!0;if("object"==typeof b&&"object"==typeof c){if(Array.isArray(b)!==Array.isArray(c))return!1;if(Array.isArray(b)){if(b.length!==c.length)return!1;for(var d=0;d<b.length;d++)if(!a(b[d],c[d]))return!1}else{var e;for(e in b)if(void 0===c[e]&&void 0!==b[e])return!1;for(e in c)if(void 0===b[e]&&void 0!==c[e])return!1;for(e in b)if(!a(b[e],c[e]))return!1}return!0}return!1}function b(a){var b=String(a).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return b?{href:b[0]||"",protocol:b[1]||"",authority:b[2]||"",host:b[3]||"",hostname:b[4]||"",port:b[5]||"",pathname:b[6]||"",search:b[7]||"",hash:b[8]||""}:null}function c(a,c){function d(a){var b=[];return a.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(a){"/.."===a?b.pop():b.push(a)}),b.join("").replace(/^\//,"/"===a.charAt(0)?"/":"")}return c=b(c||""),a=b(a||""),c&&a?(c.protocol||a.protocol)+(c.protocol||c.authority?c.authority:a.authority)+d(c.protocol||c.authority||"/"===c.pathname.charAt(0)?c.pathname:c.pathname?(a.authority&&!a.pathname?"/":"")+a.pathname.slice(0,a.pathname.lastIndexOf("/")+1)+c.pathname:a.pathname)+(c.protocol||c.authority||c.pathname?c.search:c.search||a.search)+c.hash:null}function d(a){return a.split("#")[0]}function e(a,b){if(a&&"object"==typeof a)if(void 0===b?b=a.id:"string"==typeof a.id&&(b=c(b,a.id),a.id=b),Array.isArray(a))for(var d=0;d<a.length;d++)e(a[d],b);else{"string"==typeof a.$ref&&(a.$ref=c(b,a.$ref));for(var f in a)"enum"!==f&&e(a[f],b)}}function f(a,b,c,d,e){if(Error.call(this),void 0===a)throw new Error("No code supplied for error: "+b);this.message=b,this.code=a,this.dataPath=c||"",this.schemaPath=d||"",this.subErrors=e||null;var f=new Error(this.message);if(this.stack=f.stack||f.stacktrace,!this.stack)try{throw f}catch(f){this.stack=f.stack||f.stacktrace}}function g(a,b){if(b.substring(0,a.length)===a){var c=b.substring(a.length);if(b.length>0&&"/"===b.charAt(a.length-1)||"#"===c.charAt(0)||"?"===c.charAt(0))return!0}return!1}function h(a){var b=new i,f=a||"en",g={addFormat:function(){b.addFormat.apply(b,arguments)},language:function(a){return a?(n[a]||(a=a.split("-")[0]),n[a]?(f=a,a):!1):f},addLanguage:function(a,b){var c;for(c in j)b[c]&&!b[j[c]]&&(b[j[c]]=b[c]);var d=a.split("-")[0];if(n[d]){n[a]=Object.create(n[d]);for(c in b)"undefined"==typeof n[d][c]&&(n[d][c]=b[c]),n[a][c]=b[c]}else n[a]=b,n[d]=b;return this},freshApi:function(a){var b=h();return a&&b.language(a),b},validate:function(a,c,d,e){var g=new i(b,!1,n[f],d,e);"string"==typeof c&&(c={$ref:c}),g.addSchema("",c);var h=g.validateAll(a,c,null,null,"");return!h&&e&&(h=g.banUnknownProperties()),this.error=h,this.missing=g.missing,this.valid=null===h,this.valid},validateResult:function(){var a={};return this.validate.apply(a,arguments),a},validateMultiple:function(a,c,d,e){var g=new i(b,!0,n[f],d,e);"string"==typeof c&&(c={$ref:c}),g.addSchema("",c),g.validateAll(a,c,null,null,""),e&&g.banUnknownProperties();var h={};return h.errors=g.errors,h.missing=g.missing,h.valid=0===h.errors.length,h},addSchema:function(){return b.addSchema.apply(b,arguments)},getSchema:function(){return b.getSchema.apply(b,arguments)},getSchemaMap:function(){return b.getSchemaMap.apply(b,arguments)},getSchemaUris:function(){return b.getSchemaUris.apply(b,arguments)},getMissingUris:function(){return b.getMissingUris.apply(b,arguments)},dropSchemas:function(){b.dropSchemas.apply(b,arguments)},defineKeyword:function(){b.defineKeyword.apply(b,arguments)},defineError:function(a,b,c){if("string"!=typeof a||!/^[A-Z]+(_[A-Z]+)*$/.test(a))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if("number"!=typeof b||b%1!==0||1e4>b)throw new Error("Code number must be an integer > 10000");if("undefined"!=typeof j[a])throw new Error("Error already defined: "+a+" as "+j[a]);if("undefined"!=typeof k[b])throw new Error("Error code already used: "+k[b]+" as "+b);j[a]=b,k[b]=a,m[a]=m[b]=c;for(var d in n){var e=n[d];e[a]&&(e[b]=e[b]||e[a])}},reset:function(){b.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:e,resolveUrl:c,getDocumentUri:d,errorCodes:j};return g}Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;d>h;h++)a.call(e,c[h])&&f.push(c[h]);return f}}()),Object.create||(Object.create=function(){function a(){}return function(b){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return a.prototype=b,new a}}()),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>1&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&1/0!==d&&d!==-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Object.isFrozen||(Object.isFrozen=function(a){for(var b="tv4_test_frozen_key";a.hasOwnProperty(b);)b+=Math.random();try{return a[b]=!0,delete a[b],!1}catch(c){return!0}});var i=function(a,b,c,d,e){if(this.missing=[],this.missingMap={},this.formatValidators=a?Object.create(a.formatValidators):{},this.schemas=a?Object.create(a.schemas):{},this.collectMultiple=b,this.errors=[],this.handleError=b?this.collectError:this.returnError,d&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),e&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorMessages=c,this.definedKeywords={},a)for(var f in a.definedKeywords)this.definedKeywords[f]=a.definedKeywords[f].slice(0)};i.prototype.defineKeyword=function(a,b){this.definedKeywords[a]=this.definedKeywords[a]||[],this.definedKeywords[a].push(b)},i.prototype.createError=function(a,b,c,d,e){var g=this.errorMessages[a]||m[a];if("string"!=typeof g)return new f(a,"Unknown error code "+a+": "+JSON.stringify(b),c,d,e);var h=g.replace(/\{([^{}]*)\}/g,function(a,c){var d=b[c];return"string"==typeof d||"number"==typeof d?d:a});return new f(a,h,c,d,e)},i.prototype.returnError=function(a){return a},i.prototype.collectError=function(a){return a&&this.errors.push(a),null},i.prototype.prefixErrors=function(a,b,c){for(var d=a;d<this.errors.length;d++)this.errors[d]=this.errors[d].prefixWith(b,c);return this},i.prototype.banUnknownProperties=function(){for(var a in this.unknownPropertyPaths){var b=this.createError(j.UNKNOWN_PROPERTY,{path:a},a,""),c=this.handleError(b);if(c)return c}return null},i.prototype.addFormat=function(a,b){if("object"==typeof a){for(var c in a)this.addFormat(c,a[c]);return this}this.formatValidators[a]=b},i.prototype.resolveRefs=function(a,b){if(void 0!==a.$ref){if(b=b||{},b[a.$ref])return this.createError(j.CIRCULAR_REFERENCE,{urls:Object.keys(b).join(", ")},"","");b[a.$ref]=!0,a=this.getSchema(a.$ref,b)}return a},i.prototype.getSchema=function(a,b){var c;if(void 0!==this.schemas[a])return c=this.schemas[a],this.resolveRefs(c,b);var d=a,e="";if(-1!==a.indexOf("#")&&(e=a.substring(a.indexOf("#")+1),d=a.substring(0,a.indexOf("#"))),"object"==typeof this.schemas[d]){c=this.schemas[d];var f=decodeURIComponent(e);if(""===f)return this.resolveRefs(c,b);if("/"!==f.charAt(0))return void 0;for(var g=f.split("/").slice(1),h=0;h<g.length;h++){var i=g[h].replace(/~1/g,"/").replace(/~0/g,"~");if(void 0===c[i]){c=void 0;break}c=c[i]}if(void 0!==c)return this.resolveRefs(c,b)}void 0===this.missing[d]&&(this.missing.push(d),this.missing[d]=d,this.missingMap[d]=d)},i.prototype.searchSchemas=function(a,b){if(a&&"object"==typeof a){"string"==typeof a.id&&g(b,a.id)&&void 0===this.schemas[a.id]&&(this.schemas[a.id]=a);for(var c in a)if("enum"!==c)if("object"==typeof a[c])this.searchSchemas(a[c],b);else if("$ref"===c){var e=d(a[c]);e&&void 0===this.schemas[e]&&void 0===this.missingMap[e]&&(this.missingMap[e]=e)}}},i.prototype.addSchema=function(a,b){if("string"!=typeof a||"undefined"==typeof b){if("object"!=typeof a||"string"!=typeof a.id)return;b=a,a=b.id}(a=d(a)+"#")&&(a=d(a)),this.schemas[a]=b,delete this.missingMap[a],e(b,a),this.searchSchemas(b,a)},i.prototype.getSchemaMap=function(){var a={};for(var b in this.schemas)a[b]=this.schemas[b];return a},i.prototype.getSchemaUris=function(a){var b=[];for(var c in this.schemas)(!a||a.test(c))&&b.push(c);return b},i.prototype.getMissingUris=function(a){var b=[];for(var c in this.missingMap)(!a||a.test(c))&&b.push(c);return b},i.prototype.dropSchemas=function(){this.schemas={},this.reset()},i.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},i.prototype.validateAll=function(a,b,c,d,e){var g;if(b=this.resolveRefs(b),!b)return null;if(b instanceof f)return this.errors.push(b),b;var h,i=this.errors.length,j=null,k=null;if(this.checkRecursive&&a&&"object"==typeof a){if(g=!this.scanned.length,a[this.validatedSchemasKey]){var l=a[this.validatedSchemasKey].indexOf(b);if(-1!==l)return this.errors=this.errors.concat(a[this.validationErrorsKey][l]),null}if(Object.isFrozen(a)&&(h=this.scannedFrozen.indexOf(a),-1!==h)){var m=this.scannedFrozenSchemas[h].indexOf(b);if(-1!==m)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[h][m]),null}if(this.scanned.push(a),Object.isFrozen(a))-1===h&&(h=this.scannedFrozen.length,this.scannedFrozen.push(a),this.scannedFrozenSchemas.push([])),j=this.scannedFrozenSchemas[h].length,this.scannedFrozenSchemas[h][j]=b,this.scannedFrozenValidationErrors[h][j]=[];else{if(!a[this.validatedSchemasKey])try{Object.defineProperty(a,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(a,this.validationErrorsKey,{value:[],configurable:!0})}catch(n){a[this.validatedSchemasKey]=[],a[this.validationErrorsKey]=[]}k=a[this.validatedSchemasKey].length,a[this.validatedSchemasKey][k]=b,a[this.validationErrorsKey][k]=[]}}var o=this.errors.length,p=this.validateBasic(a,b,e)||this.validateNumeric(a,b,e)||this.validateString(a,b,e)||this.validateArray(a,b,e)||this.validateObject(a,b,e)||this.validateCombinations(a,b,e)||this.validateFormat(a,b,e)||this.validateDefinedKeywords(a,b,e)||null;if(g){for(;this.scanned.length;){var q=this.scanned.pop();delete q[this.validatedSchemasKey]}this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(p||o!==this.errors.length)for(;c&&c.length||d&&d.length;){var r=c&&c.length?""+c.pop():null,s=d&&d.length?""+d.pop():null;p&&(p=p.prefixWith(r,s)),this.prefixErrors(o,r,s)}return null!==j?this.scannedFrozenValidationErrors[h][j]=this.errors.slice(i):null!==k&&(a[this.validationErrorsKey][k]=this.errors.slice(i)),this.handleError(p)},i.prototype.validateFormat=function(a,b){if("string"!=typeof b.format||!this.formatValidators[b.format])return null;var c=this.formatValidators[b.format].call(null,a,b);return"string"==typeof c||"number"==typeof c?this.createError(j.FORMAT_CUSTOM,{message:c}).prefixWith(null,"format"):c&&"object"==typeof c?this.createError(j.FORMAT_CUSTOM,{message:c.message||"?"},c.dataPath||null,c.schemaPath||"/format"):null},i.prototype.validateDefinedKeywords=function(a,b){for(var c in this.definedKeywords)for(var d=this.definedKeywords[c],e=0;e<d.length;e++){var f=d[e],g=f(a,b[c],b);if("string"==typeof g||"number"==typeof g)return this.createError(j.KEYWORD_CUSTOM,{key:c,message:g}).prefixWith(null,"format");if(g&&"object"==typeof g){var h=g.code||j.KEYWORD_CUSTOM;if("string"==typeof h){if(!j[h])throw new Error("Undefined error code (use defineError): "+h);h=j[h]}var i="object"==typeof g.message?g.message:{key:c,message:g.message||"?"},k=g.schemaPath||"/"+c.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(h,i,g.dataPath||null,k)}}return null},i.prototype.validateBasic=function(a,b,c){var d;return(d=this.validateType(a,b,c))?d.prefixWith(null,"type"):(d=this.validateEnum(a,b,c))?d.prefixWith(null,"type"):null},i.prototype.validateType=function(a,b){if(void 0===b.type)return null;var c=typeof a;null===a?c="null":Array.isArray(a)&&(c="array");var d=b.type;"object"!=typeof d&&(d=[d]);for(var e=0;e<d.length;e++){var f=d[e];if(f===c||"integer"===f&&"number"===c&&a%1===0)return null}return this.createError(j.INVALID_TYPE,{type:c,expected:d.join("/")})},i.prototype.validateEnum=function(b,c){if(void 0===c["enum"])return null;for(var d=0;d<c["enum"].length;d++){var e=c["enum"][d];if(a(b,e))return null}return this.createError(j.ENUM_MISMATCH,{value:"undefined"!=typeof JSON?JSON.stringify(b):b})},i.prototype.validateNumeric=function(a,b,c){return this.validateMultipleOf(a,b,c)||this.validateMinMax(a,b,c)||null},i.prototype.validateMultipleOf=function(a,b){var c=b.multipleOf||b.divisibleBy;return void 0===c?null:"number"==typeof a&&a%c!==0?this.createError(j.NUMBER_MULTIPLE_OF,{value:a,multipleOf:c}):null},i.prototype.validateMinMax=function(a,b){if("number"!=typeof a)return null;if(void 0!==b.minimum){if(a<b.minimum)return this.createError(j.NUMBER_MINIMUM,{value:a,minimum:b.minimum}).prefixWith(null,"minimum");if(b.exclusiveMinimum&&a===b.minimum)return this.createError(j.NUMBER_MINIMUM_EXCLUSIVE,{value:a,minimum:b.minimum}).prefixWith(null,"exclusiveMinimum")}if(void 0!==b.maximum){if(a>b.maximum)return this.createError(j.NUMBER_MAXIMUM,{value:a,maximum:b.maximum}).prefixWith(null,"maximum");if(b.exclusiveMaximum&&a===b.maximum)return this.createError(j.NUMBER_MAXIMUM_EXCLUSIVE,{value:a,maximum:b.maximum}).prefixWith(null,"exclusiveMaximum")}return null},i.prototype.validateString=function(a,b,c){return this.validateStringLength(a,b,c)||this.validateStringPattern(a,b,c)||null},i.prototype.validateStringLength=function(a,b){return"string"!=typeof a?null:void 0!==b.minLength&&a.length<b.minLength?this.createError(j.STRING_LENGTH_SHORT,{length:a.length,minimum:b.minLength}).prefixWith(null,"minLength"):void 0!==b.maxLength&&a.length>b.maxLength?this.createError(j.STRING_LENGTH_LONG,{length:a.length,maximum:b.maxLength}).prefixWith(null,"maxLength"):null},i.prototype.validateStringPattern=function(a,b){if("string"!=typeof a||void 0===b.pattern)return null;var c=new RegExp(b.pattern);return c.test(a)?null:this.createError(j.STRING_PATTERN,{pattern:b.pattern}).prefixWith(null,"pattern")},i.prototype.validateArray=function(a,b,c){return Array.isArray(a)?this.validateArrayLength(a,b,c)||this.validateArrayUniqueItems(a,b,c)||this.validateArrayItems(a,b,c)||null:null},i.prototype.validateArrayLength=function(a,b){var c;return void 0!==b.minItems&&a.length<b.minItems&&(c=this.createError(j.ARRAY_LENGTH_SHORT,{length:a.length,minimum:b.minItems}).prefixWith(null,"minItems"),this.handleError(c))?c:void 0!==b.maxItems&&a.length>b.maxItems&&(c=this.createError(j.ARRAY_LENGTH_LONG,{length:a.length,maximum:b.maxItems}).prefixWith(null,"maxItems"),this.handleError(c))?c:null},i.prototype.validateArrayUniqueItems=function(b,c){if(c.uniqueItems)for(var d=0;d<b.length;d++)for(var e=d+1;e<b.length;e++)if(a(b[d],b[e])){var f=this.createError(j.ARRAY_UNIQUE,{match1:d,match2:e}).prefixWith(null,"uniqueItems");if(this.handleError(f))return f}return null},i.prototype.validateArrayItems=function(a,b,c){if(void 0===b.items)return null;var d,e;if(Array.isArray(b.items)){for(e=0;e<a.length;e++)if(e<b.items.length){if(d=this.validateAll(a[e],b.items[e],[e],["items",e],c+"/"+e))return d}else if(void 0!==b.additionalItems)if("boolean"==typeof b.additionalItems){if(!b.additionalItems&&(d=this.createError(j.ARRAY_ADDITIONAL_ITEMS,{}).prefixWith(""+e,"additionalItems"),this.handleError(d)))return d}else if(d=this.validateAll(a[e],b.additionalItems,[e],["additionalItems"],c+"/"+e))return d}else for(e=0;e<a.length;e++)if(d=this.validateAll(a[e],b.items,[e],["items"],c+"/"+e))return d;return null},i.prototype.validateObject=function(a,b,c){return"object"!=typeof a||null===a||Array.isArray(a)?null:this.validateObjectMinMaxProperties(a,b,c)||this.validateObjectRequiredProperties(a,b,c)||this.validateObjectProperties(a,b,c)||this.validateObjectDependencies(a,b,c)||null},i.prototype.validateObjectMinMaxProperties=function(a,b){var c,d=Object.keys(a);return void 0!==b.minProperties&&d.length<b.minProperties&&(c=this.createError(j.OBJECT_PROPERTIES_MINIMUM,{propertyCount:d.length,minimum:b.minProperties}).prefixWith(null,"minProperties"),this.handleError(c))?c:void 0!==b.maxProperties&&d.length>b.maxProperties&&(c=this.createError(j.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:d.length,maximum:b.maxProperties}).prefixWith(null,"maxProperties"),this.handleError(c))?c:null},i.prototype.validateObjectRequiredProperties=function(a,b){if(void 0!==b.required)for(var c=0;c<b.required.length;c++){var d=b.required[c];if(void 0===a[d]){var e=this.createError(j.OBJECT_REQUIRED,{key:d}).prefixWith(null,""+c).prefixWith(null,"required");if(this.handleError(e))return e}}return null},i.prototype.validateObjectProperties=function(a,b,c){var d;for(var e in a){var f=c+"/"+e.replace(/~/g,"~0").replace(/\//g,"~1"),g=!1;if(void 0!==b.properties&&void 0!==b.properties[e]&&(g=!0,d=this.validateAll(a[e],b.properties[e],[e],["properties",e],f)))return d;if(void 0!==b.patternProperties)for(var h in b.patternProperties){var i=new RegExp(h);if(i.test(e)&&(g=!0,d=this.validateAll(a[e],b.patternProperties[h],[e],["patternProperties",h],f)))return d}if(g)this.trackUnknownProperties&&(this.knownPropertyPaths[f]=!0,delete this.unknownPropertyPaths[f]);else if(void 0!==b.additionalProperties){if(this.trackUnknownProperties&&(this.knownPropertyPaths[f]=!0,delete this.unknownPropertyPaths[f]),"boolean"==typeof b.additionalProperties){if(!b.additionalProperties&&(d=this.createError(j.OBJECT_ADDITIONAL_PROPERTIES,{}).prefixWith(e,"additionalProperties"),this.handleError(d)))return d}else if(d=this.validateAll(a[e],b.additionalProperties,[e],["additionalProperties"],f))return d}else this.trackUnknownProperties&&!this.knownPropertyPaths[f]&&(this.unknownPropertyPaths[f]=!0)}return null},i.prototype.validateObjectDependencies=function(a,b,c){var d;if(void 0!==b.dependencies)for(var e in b.dependencies)if(void 0!==a[e]){var f=b.dependencies[e];if("string"==typeof f){if(void 0===a[f]&&(d=this.createError(j.OBJECT_DEPENDENCY_KEY,{key:e,missing:f}).prefixWith(null,e).prefixWith(null,"dependencies"),this.handleError(d)))return d}else if(Array.isArray(f))for(var g=0;g<f.length;g++){var h=f[g];if(void 0===a[h]&&(d=this.createError(j.OBJECT_DEPENDENCY_KEY,{key:e,missing:h}).prefixWith(null,""+g).prefixWith(null,e).prefixWith(null,"dependencies"),this.handleError(d)))return d}else if(d=this.validateAll(a,f,[],["dependencies",e],c))return d}return null},i.prototype.validateCombinations=function(a,b,c){return this.validateAllOf(a,b,c)||this.validateAnyOf(a,b,c)||this.validateOneOf(a,b,c)||this.validateNot(a,b,c)||null},i.prototype.validateAllOf=function(a,b,c){if(void 0===b.allOf)return null;for(var d,e=0;e<b.allOf.length;e++){var f=b.allOf[e];if(d=this.validateAll(a,f,[],["allOf",e],c))return d}return null},i.prototype.validateAnyOf=function(a,b,c){if(void 0===b.anyOf)return null;var d,e,f=[],g=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths);for(var h=!0,i=0;i<b.anyOf.length;i++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var k=b.anyOf[i],l=this.errors.length,m=this.validateAll(a,k,[],["anyOf",i],c);if(null===m&&l===this.errors.length){if(this.errors=this.errors.slice(0,g),this.trackUnknownProperties){for(var n in this.knownPropertyPaths)e[n]=!0,delete d[n];for(var o in this.unknownPropertyPaths)e[o]||(d[o]=!0);h=!1;continue}return null}m&&f.push(m.prefixWith(null,""+i).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),h?(f=f.concat(this.errors.slice(g)),this.errors=this.errors.slice(0,g),this.createError(j.ANY_OF_MISSING,{},"","/anyOf",f)):void 0},i.prototype.validateOneOf=function(a,b,c){if(void 0===b.oneOf)return null;var d,e,f=null,g=[],h=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths);for(var i=0;i<b.oneOf.length;i++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var k=b.oneOf[i],l=this.errors.length,m=this.validateAll(a,k,[],["oneOf",i],c);if(null===m&&l===this.errors.length){if(null!==f)return this.errors=this.errors.slice(0,h),this.createError(j.ONE_OF_MULTIPLE,{index1:f,index2:i},"","/oneOf");if(f=i,this.trackUnknownProperties){for(var n in this.knownPropertyPaths)e[n]=!0,delete d[n];for(var o in this.unknownPropertyPaths)e[o]||(d[o]=!0)}}else m&&g.push(m.prefixWith(null,""+i).prefixWith(null,"oneOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),null===f?(g=g.concat(this.errors.slice(h)),this.errors=this.errors.slice(0,h),this.createError(j.ONE_OF_MISSING,{},"","/oneOf",g)):(this.errors=this.errors.slice(0,h),null)},i.prototype.validateNot=function(a,b,c){if(void 0===b.not)return null;var d,e,f=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var g=this.validateAll(a,b.not,null,null,c),h=this.errors.slice(f);return this.errors=this.errors.slice(0,f),this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),null===g&&0===h.length?this.createError(j.NOT_PASSED,{},"","/not"):null};var j={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},k={};for(var l in j)k[j[l]]=l;var m={INVALID_TYPE:"invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};f.prototype=Object.create(Error.prototype),f.prototype.constructor=f,f.prototype.name="ValidationError",f.prototype.prefixWith=function(a,b){if(null!==a&&(a=a.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+a+this.dataPath),null!==b&&(b=b.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+b+this.schemaPath),null!==this.subErrors)for(var c=0;c<this.subErrors.length;c++)this.subErrors[c].prefixWith(a,b);return this};var n={},o=h();return o.addLanguage("en-gb",m),o.tv4=o,o}),angular.module("openeis-ui.account",["openeis-ui.auth-service","openeis-ui.auth-route-service"]).config(["authRouteProvider",function(a){a.whenAuth("/account",{controller:"AccountCtrl",templateUrl:"src/account/account.tpl.html"})}]).controller("AccountCtrl",["$scope","Auth","$timeout",function(a,b,c){var d;b.account().then(function(b){a.account=b,d=angular.copy(b)}),a.$watchCollection("account",function(b){a.profile.changed=b.first_name!==d.first_name||b.email!=d.email?!0:!1}),a.profile={clearAlerts:function(){a.profile.success=!1,a.profile.error=!1},update:function(){a.profile.clearAlerts(),b.accountUpdate({first_name:a.account.first_name,email:a.account.email}).then(function(){a.profile.success=!0,a.profile.changed=!1,d=angular.copy(a.account),c(a.profile.clearAlerts,2e3)},function(b){400===b.status&&angular.forEach(b.data,function(a,c){angular.isArray(a)&&(b.data[c]=a.join("<br>"))}),a.profile.error=b})}},a.password={clearAlerts:function(){a.password.mismatch=!1,a.password.success=!1,a.password.error=!1},update:function(){return a.password.clearAlerts(),a.password.new!==a.password.newConfirm?void(a.password.mismatch=!0):void b.accountPassword({old_password:a.password.current,new_password:a.password.new}).then(function(){a.password.success=!0,a.password.current="",a.password.new="",a.password.newConfirm="",c(a.password.clearAlerts,2e3)},function(b){400===b.status&&angular.forEach(b.data,function(a,c){angular.isArray(a)&&(b.data[c]=a.join("<br>"))}),a.password.error=b})}}}]);var base=document.getElementsByTagName("base")[0];base&&base.setAttribute("href",settings.BASE_HREF),angular.module("openeis-ui",["ngAnimate","ngRoute","openeis-ui.account","openeis-ui.auth-service","openeis-ui.login","openeis-ui.project","openeis-ui.projects","openeis-ui.recovery","openeis-ui.shared-analyses","openeis-ui.signup","openeis-ui.templates"]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){a.otherwise({templateUrl:"src/404.tpl.html"}),b.html5Mode(!0),c.defaults.xsrfHeaderName="X-CSRFToken",c.defaults.xsrfCookieName="csrftoken"
}]).controller("AppCtrl",["$scope","Modals","Auth",function(a,b,c){a.modalOpen=b.modalOpen,a.$on("accountChange",function(){c.account().then(function(b){a.account=b})}),a.logOut=function(){c.logOut()}}]).run(["$rootScope","$rootElement",function(a,b){a.$on("$viewContentLoaded",function(){window.setTimeout(function(){b.find("input").checkAndTriggerAutoFillEvent()},200)})}]),angular.module("openeis-ui.analyses.analyses-service",["ngResource"]).service("Analyses",["$resource","$q",function(a,b){var c=this,d=a(settings.API_URL+"analyses/:analysisId",{analysisId:"@id"},{create:{method:"POST"}}),e=a(settings.API_URL+"analyses/:analysisId/data");c.get=function(a){return d.get({analysisId:a})},c.query=function(a){return d.query({project:a})},c.create=function(a){return d.create(a)},c.getData=function(a){return e.get({analysisId:a}).$promise.then(function(c){return outputData={},dataPromises=[],angular.forEach(c,function(b,c){"$promise"!==c&&"$resolved"!==c&&dataPromises.push(e.query({analysisId:a,output:c}).$promise.then(function(a){outputData[c]=a}))}),b.all(dataPromises).then(function(){return outputData})})}}]),angular.module("openeis-ui.analyses",["openeis-ui.analyses.analyses-service","openeis-ui.analyses.analysis-report-directive","openeis-ui.analyses.shared-analyses-service"]),angular.module("openeis-ui.analyses.analysis-report-directive",[]).directive("analysisReport",function(){return{restrict:"E",terminal:!0,scope:{arReport:"=",arData:"="},link:function(a,b){a.arReport.description&&b.append("<p>"+a.arReport.description+"</p>"),angular.forEach(a.arReport.elements,function(c){switch(c.title&&b.append("<h1>"+c.title+"</h1>"),c.type){case"Table":var d=angular.element("<table><thead><tr/></thead><tbody/></table>"),e=d.find("tbody");angular.forEach(c.column_info,function(a){d.find("tr").append("<th>"+a[1]+"</th>")}),angular.forEach(a.arData[c.table_name],function(a){var b=angular.element("<tr/>");angular.forEach(c.column_info,function(c){b.append("<td>"+a[c[0]]+"</td>")}),e.append(b)}),b.append(d);break;case"TextBlurb":b.append('<p class="text-blurb">'+c.text+"</p>");break;case"LinePlot":angular.forEach(c.xy_dataset_list,function(d){var e=[];angular.forEach(a.arData[d.table_name],function(a){e.push({x:a[d.x_column],y:a[d.y_column]})}),b.append(angular.element('<div class="line-plot" />').append(linePlotSVG(e,c.x_label,c.y_label)))});break;case"BarChart":angular.forEach(c.xy_dataset_list,function(d){var e=[];angular.forEach(a.arData[d.table_name],function(a){e.push({x:a[d.x_column],y:a[d.y_column]})}),b.append(angular.element('<div class="bar-chart" />').append(barChartSVG(e,c.x_label,c.y_label)))});break;case"ScatterPlot":angular.forEach(c.xy_dataset_list,function(d){var e=[];angular.forEach(a.arData[d.table_name],function(a){e.push({x:a[d.x_column],y:a[d.y_column]})}),b.append(angular.element('<div class="scatter-plot" />').append(scatterPlotSVG(e,c.x_label,c.y_label)))});break;case"HeatMap":var f=[];angular.forEach(a.arData[c.table_name],function(a){f.push({x:a[c.x_column],y:a[c.y_column],z:a[c.z_column]})}),b.append(angular.element('<div class="heat-map" />').append(heatMapSVG(f,c.x_label,c.y_label)))}})}}}),angular.module("openeis-ui.analyses.shared-analyses-service",["ngResource"]).service("SharedAnalyses",["$resource","$q",function(a,b){var c=this,d=a(settings.API_URL+"shared-analyses/:analysisId",{analysisId:"@analysis"}),e=a(settings.API_URL+"shared-analyses/:analysisId/data");c.get=function(a,b){return d.get({analysisId:a,key:b})},c.query=function(a){return d.query({project:a})},c.create=function(a){return d.save({analysisId:null},{analysis:a})},c.getData=function(a,c){return e.get({analysisId:a,key:c}).$promise.then(function(d){return outputData={},dataPromises=[],angular.forEach(d,function(b,d){"$promise"!==d&&"$resolved"!==d&&dataPromises.push(e.query({analysisId:a,key:c,output:d}).$promise.then(function(a){outputData[d]=a}))}),b.all(dataPromises).then(function(){return outputData})})}}]),angular.module("openeis-ui.applications-service",["ngResource"]).service("Applications",["$resource",function(a){var b=this,c=a(settings.API_URL+"applications");b.query=function(){return c.query()}}]),angular.module("openeis-ui.auth-route-service",["openeis-ui.auth-service","ngRoute"]).provider("authRoute",["$routeProvider",function(a){this.whenAnon=function(b,c){return c.resolve=c.resolve||{},angular.extend(c.resolve,{anon:["authRoute",function(a){return a.requireAnon()}]}),a.when(b,c),this},this.whenAuth=function(b,c){return c.resolve=c.resolve||{},angular.extend(c.resolve,{auth:["authRoute",function(a){return a.requireAuth()}]}),a.when(b,c),this},this.when=function(b,c){return a.when(b,c),this},this.$get=["Auth","$q","$location",function(a,b,c){return{requireAnon:function(){var d=b.defer();return a.account().then(function(a){a?(c.url(settings.AUTH_HOME),d.reject()):d.resolve()}),d.promise},requireAuth:function(){var d=b.defer();return a.account().then(function(b){b?d.resolve():(a.loginRedirect(c.url()),c.url(settings.LOGIN_PAGE),d.reject())}),d.promise}}}]}]),angular.module("openeis-ui.auth-service",["ngResource"]).service("Auth",["$resource","$q","$location","$rootScope",function(a,b,c,d){function e(){var a=b.defer();return h.get().$promise.then(function(a){g=a},function(){g=!1}).finally(function(){d.$broadcast("accountChange"),a.resolve(g)}),a.promise}var f=this,g=null,h=a(settings.API_URL+"account",null,{create:{method:"POST"},update:{method:"PATCH"}}),i=a(settings.API_URL+"account/login"),j=a(settings.API_URL+"account/change_password"),k=a(settings.API_URL+"account/password_reset",null,{put:{method:"PUT"}}),l=null;f.account=function(){if(null===g)return e();var a=b.defer();return a.resolve(g),a.promise},f.accountCreate=function(a){return h.create(a).$promise},f.accountUpdate=function(a){return h.update(a).$promise},f.accountPassword=function(a){return j.save(a).$promise},f.accountRecover1=function(a){return k.save({username_or_email:a}).$promise},f.accountRecover2=function(a){return k.put(a).$promise},f.logIn=function(a){var d=b.defer();return i.save(a,function(){e().then(function(){null!==l?(c.url(l),l=null):c.url(settings.AUTH_HOME),d.resolve()})},function(a){d.reject(a)}),d.promise},f.loginRedirect=function(a){l=a},f.logOut=function(){var a=b.defer();return i.delete(function(){g=!1,d.$broadcast("accountChange"),c.url(settings.LOGIN_PAGE),a.resolve()},function(b){a.reject(b)}),a.promise}}]),angular.module("openeis-ui.data-files",["ngResource"]).service("DataFiles",["$resource","$http",function(a,b){var c=this,d=a(settings.API_URL+"files/:fileId",{fileId:"@id"},{head:{method:"GET",url:settings.API_URL+"files/:fileId/head"},update:{method:"PATCH"}});c.get=function(a){return d.get({fileId:a}).$promise},c.query=function(a){return d.query({project:a}).$promise},c.update=function(a){return d.update(a).$promise},c.head=function(a){return d.head({fileId:a,rows:5}).$promise},c.timestamps=function(a,c,d,e){return b.get(settings.API_URL+"files/"+a+"/timestamps",{transformResponse:angular.fromJson,params:{time_offset:c,time_zone:d,columns:e}}).then(function(a){return a.data})}}]).filter("hasSignature",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){angular.equals(b,a.signature)&&c.push(a)}),c}}).filter("hasTimestamp",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.timestamp&&b.push(a)}),b}}),angular.module("openeis-ui.data-maps.data-maps-service",["ngResource","openeis-ui.data-files"]).service("DataMaps",["$http","$resource","DataFiles",function(a,b,c){var d=this,e=b(settings.API_URL+"sensormaps/:mapId",{mapId:"@id"},{create:{method:"POST"}});d.get=function(a){return e.get({mapId:a})},d.query=function(a){return e.query({project:a})},d.create=function(a){var b=angular.copy(a);return b.map=d.flattenMap(b.map),e.create(b)},d.getDefinition=function(){return a.get(settings.GENERAL_DEFINITION_URL).then(function(a){return a.data})},d.getUnits=function(){return a.get(settings.UNITS_URL).then(function(a){return a.data})},d.flattenMap=function(a){function b(a,c){var f={};return angular.forEach(a,function(a){if(a.deleted!==!0){delete a.deleted;var g=c+a.name.replace("/","-"),h=a.sensors||{},i=a.children||{};delete a.name,delete a.sensors,delete a.children,a.file&&(a.column=a.file.hasHeader?a.file.columns[parseInt(a.column)]:parseInt(a.column),d[a.file.file]||(d[a.file.file]={key:e++ +"",signature:a.file.signature,timestamp:a.file.timestamp}),a.file=d[a.file.file].key),f[g]=a,angular.extend(f,b(h,g+settings.DATAMAP_TOPIC_SEPARATOR)),angular.extend(f,b(i,g+settings.DATAMAP_TOPIC_SEPARATOR))}}),f}var c=angular.copy(a),d={},e=0;return c.sensors=b(c.sensors,""),c.files=c.files||{},angular.forEach(d,function(a){c.files[a.key]=a,delete c.files[a.key].key}),c},d.validateMap=function(b){return a.get(settings.DATAMAP_SCHEMA_URL).then(function(a){return tv4.validateMultiple(d.flattenMap(b),a.data)})},d.ensureFileMetaData=function(a){angular.forEach(a,function(a){a.hasOwnProperty("signature")&&a.hasOwnProperty("columns")&&a.hasOwnProperty("hasHeader")||c.head(a.id).then(function(b){a.signature={headers:[]},a.columns=[],a.hasHeader=b.has_header,angular.forEach(b.rows[0],function(b,c){a.hasHeader?(a.signature.headers.push(b),a.columns.push(b)):(a.signature.headers.push(null),a.columns.push("Column "+(c+1)))})})})}}]),angular.module("openeis-ui.data-maps",["ngResource","openeis-ui.data-maps.data-maps-service","openeis-ui.data-maps.sensor-container-directive"]),angular.module("openeis-ui.data-maps.sensor-container-directive",["RecursionHelper","openeis-ui.filters","openeis-ui.data-maps.data-maps-service"]).directive("sensorContainer",["RecursionHelper",function(a){return{restrict:"E",scope:{container:"=",files:"="},templateUrl:"src/components/data-maps/sensor-container-directive.tpl.html",controller:["$scope","DataMaps",function(a,b){b.getDefinition().then(function(b){a.definition=b,a.objectDefinition="system"===a.container.level?b.systems[a.container.name]:b[a.container.level],a.objectDefinition.sensor_list&&("*"===a.objectDefinition.sensor_list&&(a.objectDefinition.sensor_list=[],angular.forEach(b.sensors,function(b,c){a.objectDefinition.sensor_list.push(c)})),a.objectDefinition.sensor_list.sort())}),b.getUnits().then(function(b){a.units=b}),a.newAttribute={},a.addAttribute=function(){"address"===a.newAttribute.name&&(a.newAttribute.value={address:"123 Anystreet",city:"Anytown",state:"US",zip_code:"12345"}),a.container.attributes=a.container.attributes||{},a.container.attributes[a.newAttribute.name]=angular.copy(a.newAttribute.value),a.objectDefinition.attribute_list.splice(a.objectDefinition.attribute_list.indexOf(a.newAttribute.name),1),a.newAttribute={}},a.newSensor={},a.$watchCollection("newSensor",function(){a.newSensor.file&&a.newSensor.file.columns[a.newSensor.column]||(a.newSensor.column=""),a.newSensor.name&&a.units[a.definition.sensors[a.newSensor.name].unit_type]&&a.units[a.definition.sensors[a.newSensor.name].unit_type][a.newSensor.unit]||delete a.newSensor.unit}),a.addSensor=function(){a.newSensor.type=a.newSensor.name,a.container.sensors=a.container.sensors||[],a.container.sensors.unshift(angular.copy(a.newSensor)),a.objectDefinition.sensor_list.splice(a.objectDefinition.sensor_list.indexOf(a.newSensor.name),1),a.newSensor={}},a.deleteSensor=function(b){a.objectDefinition.sensor_list.push(a.container.sensors[b].name),a.objectDefinition.sensor_list.sort(),a.container.sensors.splice(b,1)},a.addChild=function(b){var c,d="Name:",e=function(a){return a.name===c};a.container.children=a.container.children||[];do{if(c=prompt(d),!c)return;c=c.replace("/","-"),d='Error: "'+c+'" already exists. Name:'}while(a.container.children.some(e));a.container.children.unshift({level:b,name:c})}}],compile:function(b){return a.compile(b)}}}]),angular.module("openeis-ui.data-sets-service",["ngResource"]).service("DataSets",["$resource","$http",function(a,b){var c=this,d=a(settings.API_URL+"datasets/:dataSetId",{dataSetId:"@id"},{create:{method:"POST"}});c.create=function(a){return d.create(a)},c.query=function(a){return d.query({project:a})},c.getStatus=function(a){return b({method:"GET",url:settings.API_URL+"datasets/"+a.id+"/status",transformResponse:angular.fromJson})},c.getErrors=function(a){return b({method:"GET",url:settings.API_URL+"datasets/"+a.id+"/errors",transformResponse:angular.fromJson})}}]),angular.module("openeis-ui.file-upload-directive",[]).directive("fileUpload",["$parse",function(a){return{restrict:"E",template:'<input type="file"><button disabled>Upload</button>',compile:function(b,c){return clickFn=a(c.fileUploadClick),function(a,b){var c=b.find("input"),d=b.find("button");c.on("change",function(){c[0].files.length?d.prop("disabled",!1):d.prop("disabled",!0)}),d.on("click",function(b){a.$apply(function(){clickFn(a,{$event:b,fileInput:c})})})}}}}]),angular.module("openeis-ui.filters",[]).filter("bytes",function(){return function(a,b){if(isNaN(parseFloat(a))||!isFinite(a))return"--";"undefined"==typeof b&&(b=0);var c=["B","KB","MB","GB","TB","PB"],d=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(d))).toFixed(b)+" "+c[d]}}).filter("capitalize",function(){return function(a){return a?a.substring(0,1).toUpperCase()+a.substring(1):""}}),angular.module("openeis-ui.modals",[]).directive("modal",function(){return{restrict:"E",transclude:!0,templateUrl:"src/components/modals/modal.tpl.html"}}).service("Modals",function(){var a=this,b={};a.openModal=function(a){b[a]=!0},a.closeModal=function(a){delete b[a]},a.modalOpen=function(a){return"undefined"==typeof a?!angular.equals(b,{}):b.hasOwnProperty(a)}}),angular.module("openeis-ui.projects-service",["ngResource"]).service("Projects",["$resource",function(a){var b=this,c=a(settings.API_URL+"projects/:projectId",{projectId:"@id"},{create:{method:"POST"},save:{method:"PUT"},clone:{method:"POST",url:settings.API_URL+"projects/:projectId/clone"}});b.get=function(a){return c.get({projectId:a}).$promise},b.query=function(){return c.query().$promise},b.create=function(a){return c.create(a).$promise},b.clone=function(a,b){return c.clone({projectId:a},{name:b}).$promise}}]),angular.module("openeis-ui.login",["openeis-ui.auth-service","openeis-ui.auth-route-service"]).config(["authRouteProvider",function(a){a.whenAnon("/",{controller:"LoginCtrl",templateUrl:"src/login/login.tpl.html"})}]).controller("LoginCtrl",["$scope","Auth",function(a,b){a.logIn=function(){b.logIn({username:a.form.username,password:a.form.password}).catch(function(b){a.form.error=b.status})},a.clearError=function(){a.form.error=null}}]),angular.module("openeis-ui.project.configure-timestamp-controller",["openeis-ui.modals","openeis-ui.data-files"]).controller("ConfigureTimestampCtrl",["$scope","DataFiles","$http","Modals",function(a,b,c,d){a.modal={columns:{},timeOffset:0,timeZone:jstz.determine().name()},a.preview=function(){a.selectedColumns=[],angular.forEach(a.modal.columns,function(b,c){b===!0&&a.selectedColumns.push(parseInt(c))}),b.timestamps(a.timestampFile.id,a.modal.timeOffset,a.modal.timeZone,a.selectedColumns.join(",")).then(function(b){a.modal.confirm=!0,a.modal.timestamps=b},function(a){alert(angular.toJson(a.data))})},a.save=function(){var c={columns:a.selectedColumns};b.update({id:a.timestampFile.id,timestamp:c,time_offset:a.modal.timeOffset,time_zone:a.modal.timeZone}).then(function(){a.timestampFile.timestamp=c,a.timestampFile.time_zone=a.modal.timeZone,d.closeModal("configureTimestamp")},function(a){alert(angular.toJson(a))})}}]),angular.module("openeis-ui.project.new-analysis-controller",["openeis-ui.applications-service","openeis-ui.filters","openeis-ui.modals","openeis-ui.data-maps","openeis-ui.analyses"]).controller("NewAnalysisCtrl",["$scope","Applications","DataMaps","$q","Modals","Analyses",function(a,b,c,d,e,f){a.newAnalysis={debug:!1},a.$watch("newAnalysis.dataSet",function(){if(a.availableApps=[],a.newAnalysis.dataSet){var e=c.get(a.newAnalysis.dataSet.map).$promise,f=b.query().$promise;d.all({map:e,apps:f}).then(function(b){a.availableSensors={},angular.forEach(b.map.map.sensors,function(b,c){b.type&&(a.availableSensors.hasOwnProperty(b.type)||(a.availableSensors[b.type]=[]),a.availableSensors[b.type].push(c))}),angular.forEach(b.apps,function(b){var c={},d=[];return angular.forEach(b.inputs,function(a){c.hasOwnProperty(a.sensor_type)||(c[a.sensor_type]=0),c[a.sensor_type]+=a.count_min}),angular.forEach(c,function(b,c){var e=0;a.availableSensors[c]&&(e=a.availableSensors[c].length),b>e&&d.push("At least "+b+" "+c+" required, "+e+" available in data set")}),d.length?void a.availableApps.push({name:b.name,missingInputs:d}):void a.availableApps.push(b)})})}});var g;a.$watch("newAnalysis.application",function(b){b&&b!==g&&(a.newAnalysis.configuration={parameters:{},inputs:{}},angular.forEach(b.inputs,function(b,c){a.newAnalysis.configuration.inputs[c]=[];for(var d=0;d++<b.count_min;)a.newAnalysis.configuration.inputs[c].push({})}),g=b)}),a.canAddSensor=function(b,c){var d=a.newAnalysis.application,e=a.newAnalysis.configuration;return e.inputs[b].length>=a.availableSensors[c].length?!1:d.inputs[b].count_max&&e.inputs[b].length>=d.inputs[b].count_max?!1:!0},a.addInputSensor=function(b){a.newAnalysis.configuration.inputs[b].push({})},a.deleteInputSensor=function(b,c){a.newAnalysis.configuration.inputs[b].splice(c,1)},a.run=function(){f.create({name:"Data set "+a.newAnalysis.dataSet.id+" - "+a.newAnalysis.application.name,dataset:a.newAnalysis.dataSet.id,application:a.newAnalysis.application.name,configuration:a.newAnalysis.configuration,debug:a.newAnalysis.debug}).$promise.then(function(b){a.analyses.push(b),a.statusCheck(),e.closeModal("newAnalysis")},function(a){alert(angular.toJson(a.data,!0))})}}]),angular.module("openeis-ui.project.new-data-map-controller",["openeis-ui.modals","openeis-ui.data-maps"]).controller("NewDataMapCtrl",["$scope","DataMaps","Modals",function(a,b,c){b.ensureFileMetaData(a.dataFiles),a.newDataMap={project:a.project.id,map:{version:1,sensors:[]},valid:!1},a.$watch("newDataMap.map",function(){b.validateMap(a.newDataMap.map).then(function(b){a.newDataMap.valid=b.valid})},!0),a.save=function(){b.create(a.newDataMap).$promise.then(function(b){a.dataMaps.push(b),c.closeModal("newDataMap")},function(a){alert(a.data.__all__.join("\n"))})},a.addChild=function(b){var c,d="Name:",e=function(a){return a.name===c};do{if(c=prompt(d),!c)return;c=c.replace("/","-"),d='Error: "'+c+'" already exists. Name:'}while(a.newDataMap.map.sensors.some(e));a.newDataMap.map.sensors.unshift({level:b,name:c})}}]),angular.module("openeis-ui.project.new-data-set-controller",["openeis-ui.modals","openeis-ui.data-maps","openeis-ui.data-sets-service"]).controller("NewDataSetCtrl",["$scope","DataSets","DataMaps","Modals",function(a,b,c,d){c.ensureFileMetaData(a.dataFiles),a.newDataSet={files:{}},a.save=function(){var c=[];angular.forEach(a.newDataSet.files,function(a,b){c.push({name:b,file:a})}),b.create({map:a.newDataSet.map.id,files:c}).$promise.then(function(b){a.dataSets.push(b),a.statusCheck(),d.closeModal("newDataSet")},function(a){alert(angular.toJson(a,!0))})}}]),angular.module("openeis-ui.project.project-controller",["angularFileUpload","openeis-ui.data-files","openeis-ui.analyses","openeis-ui.data-sets-service","openeis-ui.modals"]).controller("ProjectCtrl",["$scope","project","dataFiles","DataFiles","dataSets","DataSets","dataMaps","$upload","$timeout","$q","$http","Modals","analyses","Analyses","sharedAnalyses","SharedAnalyses",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.project=b,a.dataFiles=c,a.dataSets=e,a.dataMaps=g,a.Modals=l,a.analyses=m,a.sharedAnalyses=o;var q;a.statusCheck=function(){angular.forEach(a.dataSets,function(b){if(!b.status||"complete"!==b.status.status){var c=[];c.push(f.getStatus(b).then(function(a){b.status=a.data,"processing"===b.status.status&&(b.status.status+=" - "+Math.floor(parseFloat(b.status.percent))+"%")})),c.push(f.getErrors(b).then(function(a){b.errors=a.data})),j.all(c).then(function(){"complete"!==b.status.status&&(i.cancel(q),q=i(a.statusCheck,1e3))})}}),angular.forEach(a.analyses,function(b){"complete"!==b.status&&"error"!==b.status&&n.get(b.id).$promise.then(function(c){angular.extend(b,c),"complete"!==b.status&&"error"!==b.status&&(i.cancel(q),q=i(a.statusCheck,1e3))})})},a.statusCheck(),a.configureTimestamp=function(b){var c={timeZones:k.get(settings.TIMEZONES_URL)};a.dataFiles[b].head||(c.head=d.head(a.dataFiles[b].id)),j.all(c).then(function(c){c.head&&(c.head.has_header&&(c.head.header=c.head.rows.shift()),a.dataFiles[b].head=c.head,a.dataFiles[b].cols=[],angular.forEach(a.dataFiles[b].head.rows[0],function(c,d){a.dataFiles[b].cols.push(d)})),a.timestampFile=a.dataFiles[b],a.timeZones=c.timeZones.data,l.openModal("configureTimestamp")})},a.upload=function(c){angular.forEach(c[0].files,function(e){h.upload({url:settings.API_URL+"projects/"+b.id+"/add_file",file:e}).then(function(b){d.get(b.data.id).then(function(b){a.dataFiles.push(b),a.configureTimestamp(a.dataFiles.length-1)}),c.val("").triggerHandler("change")})})},a.deleteFile=function(b){a.dataFiles[b].$delete(function(){a.dataFiles.splice(b,1)})},a.errorsModal={},a.showErrors=function(b){a.errorsModal.files={},angular.forEach(b.files,function(b){angular.forEach(a.dataFiles,function(c){c.id===b.file&&(a.errorsModal.files[b.name]=c.file)}),a.errorsModal.files[b.name]||(a.errorsModal.files[b.name]='File "'+b.name+'"')}),a.errorsModal.errors=b.errors},a.deleteDataSet=function(b){a.dataSets[b].$delete(function(){a.dataSets.splice(b,1)})},a.deleteDataMap=function(b){a.dataMaps[b].$delete(function(){a.dataMaps.splice(b,1)})},a.viewAnalysis=function(b){a.viewingAnalysisData=n.getData(b.id).then(function(c){a.viewingAnalysis=b,a.viewingAnalysisData=c,l.openModal("viewAnalysis")})},a.shareAnalysis=function(b){p.create(b.id).$promise.then(function(c){a.sharedAnalyses.push(c),a.viewLink(b.id)})},a.viewLink=function(b){angular.forEach(a.sharedAnalyses,function(c){c.analysis===b&&(a.viewingLink={url:window.location.protocol+"//"+window.location.host+"/shared-analyses/"+b+"/"+c.key,sharedAnalysis:c},l.openModal("viewLink"))})},a.revokeLink=function(b){confirm("Revoke sharing?")&&(b.sharedAnalysis.$delete(function(){a.sharedAnalyses.splice(a.sharedAnalyses.indexOf(b.sharedAnalysis),1)}),l.closeModal("viewLink"))}}]),angular.module("openeis-ui.project",["openeis-ui.auth-route-service","openeis-ui.file-upload-directive","openeis-ui.filters","openeis-ui.projects-service","openeis-ui.analyses","openeis-ui.data-files","openeis-ui.data-maps","openeis-ui.data-sets-service","openeis-ui.project.configure-timestamp-controller","openeis-ui.project.new-analysis-controller","openeis-ui.project.new-data-map-controller","openeis-ui.project.new-data-set-controller","openeis-ui.project.project-controller"]).config(["authRouteProvider",function(a){a.whenAuth("/projects/:projectId",{controller:"ProjectCtrl",templateUrl:"src/project/project.tpl.html",resolve:{project:["Projects","$route",function(a,b){return a.get(b.current.params.projectId)}],dataFiles:["DataFiles","$route",function(a,b){return a.query(b.current.params.projectId)}],dataSets:["DataSets","$route",function(a,b){return a.query(b.current.params.projectId).$promise}],dataMaps:["DataMaps","$route",function(a,b){return a.query(b.current.params.projectId).$promise}],analyses:["Analyses","$route",function(a,b){return a.query(b.current.params.projectId).$promise}],sharedAnalyses:["SharedAnalyses","$route",function(a,b){return a.query(b.current.params.projectId).$promise}]}})}]),angular.module("openeis-ui.projects.projects-controller",["openeis-ui.projects-service"]).controller("ProjectsCtrl",["$scope","projects","Projects",function(a,b,c){a.projects=b,a.newProject={name:"",create:function(){c.create({name:a.newProject.name}).then(function(b){a.newProject.name="",a.projects.push(b)})}},a.renameProject=function(b){var c=prompt("New project name:");c&&c.length&&(a.projects[b].name=c,a.projects[b].$save(function(c){a.projects[b]=c}))},a.deleteProject=function(b){a.projects[b].$delete(function(){a.projects.splice(b,1)})},a.cloneProject=function(b){var d=prompt("Cloned project name:");d&&d.length&&c.clone(a.projects[b].id,d).then(function(b){a.projects.push(b)})}}]),angular.module("openeis-ui.projects",["openeis-ui.auth-route-service","openeis-ui.projects-service","openeis-ui.projects.projects-controller"]).config(["authRouteProvider",function(a){a.whenAuth("/projects",{controller:"ProjectsCtrl",templateUrl:"src/projects/projects.tpl.html",resolve:{projects:["Projects",function(a){return a.query()}]}})}]),angular.module("openeis-ui.recovery",["openeis-ui.auth-service","openeis-ui.auth-route-service"]).config(["authRouteProvider",function(a){a.whenAnon("/recovery",{controller:"RecoveryCtrl",templateUrl:"src/recovery/recovery.tpl.html"})}]).controller("RecoveryCtrl",["$scope","Auth","$routeParams",function(a,b,c){a.form={stage:1},c.username&&c.code?(a.form.stage=2,a.recovery={username:c.username,code:c.code}):a.recovery={},a.submit=function(){switch(a.form.stage){case 1:return void b.accountRecover1(a.recovery.id).then(function(){a.form.success="Email with temporary password reset link sent.",a.form.stage=!1,a.clearError()},function(b){404===b.status&&(b.data="Account with specified username or email address not found."),a.form.error=b});case 2:return a.recovery.password!==a.recovery.passwordConfirm?void(a.form.error={status:400,data:"Passwords do not match."}):void b.accountRecover2(a.recovery).then(function(){a.form.success="Password updated.",a.form.stage=!1,a.clearError()},function(b){404===b.status&&(b.data="Invalid password reset link."),a.form.error=b})}},a.clearError=function(){a.form.error=!1}}]);var settings={BASE_HREF:"/",API_URL:"/api/",LOGIN_PAGE:"/",AUTH_HOME:"/projects",GENERAL_DEFINITION_URL:"/static/projects/json/general_definition.json",DATAMAP_SCHEMA_URL:"/static/projects/json/sensormap-schema.json",UNITS_URL:"/static/projects/json/units.json",TIMEZONES_URL:"/static/projects/json/time_zones.json",DATAMAP_TOPIC_SEPARATOR:"/"};angular.module("openeis-ui.shared-analyses.shared-analyses-controller",[]).controller("SharedAnalysesCtrl",["$scope","SharedAnalyses","$routeParams","$location",function(a,b,c){a.valid=!0,b.get(c.analysisId,c.key).$promise.then(function(d){b.getData(d.analysis,c.key).then(function(b){a.sharedAnalysis=d,a.data=b})},function(){a.valid=!1})}]),angular.module("openeis-ui.shared-analyses",["openeis-ui.analyses","openeis-ui.auth-route-service","openeis-ui.shared-analyses.shared-analyses-controller"]).config(["authRouteProvider",function(a){a.when("/shared-analyses/:analysisId/:key",{controller:"SharedAnalysesCtrl",templateUrl:"src/shared-analyses/shared-analyses.tpl.html"})}]),angular.module("openeis-ui.signup",["openeis-ui.auth-service","openeis-ui.auth-route-service"]).config(["authRouteProvider",function(a){a.whenAnon("/sign-up",{controller:"SignUpCtrl",templateUrl:"src/signup/signup.tpl.html"})}]).controller("SignUpCtrl",["$scope","$location","Auth",function(a,b,c){a.form={},a.submit=function(){return a.account.password!==a.account.passwordConfirm?void(a.form.passwordConfirm="Passwords do not match."):void c.accountCreate(a.account).then(function(){c.logIn({username:a.account.username,password:a.account.password}).catch(function(b){a.form.error=b.status})},function(b){400===b.status&&angular.forEach(b.data,function(a,c){angular.isArray(a)&&(b.data[c]=a.join("<br>"))}),a.form.error=b})},a.clearError=function(){a.form.error=null}}]),angular.module("openeis-ui.templates",[]).run(["$templateCache",function(a){"use strict";a.put("src/404.tpl.html","<h2>404 Page not found</h2>"),a.put("src/account/account.tpl.html",'<div class=container><ul class=breadcrumbs><li>Account</li></ul><div class="view view--account"><h2>Account</h2><h3>Profile</h3><form ng-submit=profile.update()><div class=form__group><label>Username</label><input ng-model=account.username disabled></div><div class=form__group><label for=name>Name</label><input id=name type=text ng-model=account.first_name></div><div class=form__group><label for=email>Email address</label><input id=email type=email ng-change="profile.error.data.email = false" ng-model=account.email> <small class="help help--error" ng-if=profile.error.data.email>{{profile.error.data.email}}</small></div><div class=form__group><button ng-disabled=!profile.changed>Update profile</button></div><div class="alert alert--success animated--slow-out" ng-if=profile.success>Profile updated.</div><div class="alert alert--error" ng-if="profile.error.status && profile.error.status !== 400">Unknown error occurred. ({{profile.error.status}})</div></form><h3>Password</h3><form ng-submit=password.update()><div class=form__group><label for=current-password>Current password</label><input id=current-password type=password autocomplete=off ng-trim=false ng-change="password.error.data.old_password = false" required ng-model=password.current> <small class="help help--error" ng-if=password.error.data.old_password>{{password.error.data.old_password}}</small><br><label for=new-password>New password</label><input id=new-password type=password autocomplete=off required ng-trim=false ng-change="password.mismatch = false; password.error.data.new_password = false" ng-model=password.new> <small class="help help--error" ng-if=password.error.data.new_password>{{password.error.data.new_password}}</small><br><label for=confirm-new-password>Confirm new password</label><input id=confirm-new-password type=password autocomplete=off required ng-trim=false ng-change="password.mismatch = false" ng-model=password.newConfirm> <small class="help help--error" ng-if=password.mismatch>New passwords do not match.</small><br></div><div class=form__group><button ng-disabled="!(password.current && password.new && password.newConfirm)" ng-click=updatePassword()>Update password</button></div><div class="alert alert--success animated--slow-out" ng-if=password.success>Password updated.</div></form></div></div>'),a.put("src/components/data-maps/sensor-container-directive.tpl.html",'<div ng-if=container.deleted><strong>{{container.level | capitalize}}: {{container.name}}</strong> deleted. (<a ng-click="container.deleted = false">undo</a>)</div><div ng-if=!container.deleted><h1>{{container.level | capitalize}}: {{container.name}} <button ng-click="container.deleted = true">Delete</button></h1><div class=layout><div class=layout__item style=width:50% ng-if="objectDefinition.attribute_list.length || container.attributes"><fieldset><legend>Attributes</legend><form class=form--stacked ng-submit=addAttribute() ng-if=objectDefinition.attribute_list.length><div class=form__group><label>New attribute</label><select required ng-options="attribute for attribute in objectDefinition.attribute_list" ng-model=newAttribute.name><option value="">-- Choose attribute --</option></select></div><button>Add</button></form><dl ng-if=container.attributes><dt ng-repeat-start="(attribute, value) in container.attributes">{{attribute}}</dt><dd ng-repeat-end><pre>{{value | json}}</pre></dd></dl></fieldset></div><div class=layout__item style=width:50% ng-if="objectDefinition.sensor_list.length || container.sensors"><fieldset><legend>Sensors</legend><form class=form--stacked ng-submit=addSensor() ng-if=objectDefinition.sensor_list.length><div class=form__group><label>New sensor</label><select required ng-options="sensor for sensor in objectDefinition.sensor_list" ng-model=newSensor.name><option value="">-- Choose sensor --</option></select></div><div class=form__group ng-if=newSensor.name><label>Source</label><select required ng-model=newSensor.file ng-options="file.file for file in files | hasTimestamp"><option value="">-- Choose file --</option></select><select required ng-model=newSensor.column ng-options="key as column for (key, column) in newSensor.file.columns"><option value="">-- Choose column --</option></select></div><div class=form__group ng-if=newSensor.name><label>Value unit</label><select required ng-model=newSensor.unit ng-options="key as unit.value for (key, unit) in units[definition.sensors[newSensor.name].unit_type]"><option value="">-- Choose unit --</option></select></div><button>Add</button></form><dl ng-if=container.sensors><dt ng-repeat-start="sensor in container.sensors">{{sensor.name}}</dt><dd ng-repeat-end>{{sensor.file.file}} &rarr; {{sensor.file.columns[sensor.column]}}<span ng-if=sensor.unit>&nbsp;({{sensor.unit}})</span> (<a ng-click=deleteSensor($index)>delete</a>)</dd></dl></fieldset></div></div><div class=form__group>Add under {{container.name}}:<span ng-repeat="child in objectDefinition.child_list">&nbsp;<button ng-click=addChild(child)>{{child}}</button></span></div><sensor-container ng-repeat="child in container.children" container=child files=files></sensor-container></div>'),a.put("src/components/modals/modal.tpl.html","<div class=modal__backdrop><div class=modal__dialog><div ng-transclude></div></div></div>"),a.put("src/login/login.tpl.html",'<div class=container><div class="view view--login"><h1>OpenEIS</h1><form ng-submit=logIn()><div class=form__group><input type=text placeholder=Username required ng-model=form.username ng-change=clearError()></div><div class=form__group><input type=password placeholder=Password required ng-model=form.password ng-trim=false ng-change=clearError()></div><div class=form__group><button type=submit>Log in</button><div class=links><a href=sign-up>Need an account?</a><br><a href=recovery>Can\'t log in?</a></div></div><div class="alert alert--error" ng-if=form.error ng-switch=form.error><span ng-switch-when=403>Authentication failed.</span> <span ng-switch-default>Unknown error occurred. ({{form.error}})</span></div></form></div></div>'),a.put("src/project/configure-timestamp.tpl.html",'<h4>Configure timestamp: {{timestampFile.file}}</h4><form ng-if=!modal.confirm ng-submit=preview()><table class=table--file-preview><thead><tr><th colspan={{timestampFile.cols.length}}>Select columns that comprise timestamp:</th></tr><tr><th ng-repeat="col in timestampFile.cols"><input type=checkbox ng-model=modal.columns[$index]></th></tr><tr ng-if=timestampFile.head.header.length><th ng-repeat="header in timestampFile.head.header"><label for={{$index}}>{{header}}</label></th></tr></thead><tbody><tr ng-repeat="row in timestampFile.head.rows"><td ng-repeat="col in row track by $index">{{col}}</td></tr></tbody></table><div class=form__group><label class=label--inline>Apply offset to timestamps</label>&nbsp; <input type=number step=0.000001 required ng-model=modal.timeOffset>&nbsp;seconds</div><div class=form__group><label class=label--inline>If unable to determine time zone, use</label>&nbsp;<select class=select--inline required ng-options="timeZone for timeZone in timeZones" ng-model=modal.timeZone></select></div><button>Continue</button> <button type=button ng-click="Modals.closeModal(\'configureTimestamp\')">Cancel</button></form><div ng-if=modal.confirm><table><thead><tr><th>Raw</th><th>Parsed</th></tr></thead><tbody><tr ng-repeat="row in modal.timestamps | limitTo:5"><td>{{row[0]}}</td><td>{{row[1]}}</td></tr></tbody></table><p>Are the parsed timestamps correct?</p><button ng-click=save()>Yes, save configuration</button> <button ng-click="modal.confirm = false">No, re-select columns</button> <button ng-click="Modals.closeModal(\'configureTimestamp\')">Cancel</button></div>'),a.put("src/project/new-analysis.tpl.html",'<h4>New analysis</h4><div ng-if=!newAnalysis.application><div class=form__group><label class=label--inline>Run analysis on</label>&nbsp;<select ng-options="dataSet as (\'Data set \' + dataSet.id) for dataSet in dataSets" ng-model=newAnalysis.dataSet><option value="">-- Choose data set --</option></select></div><table class=table--app-list ng-if=newAnalysis.dataSet><thead><tr><th>Application</th><th>Configure</th><th>Missing inputs</th></tr></thead><tbody><tr ng-repeat="app in availableApps"><td>{{app.name}}</td><td><button ng-disabled=app.missingInputs ng-click="newAnalysis.application = app">Configure</button></td><td><ul class=missing-inputs ng-if=app.missingInputs><li ng-repeat="missingInput in app.missingInputs">{{missingInput}}</li></ul></td></tr></tbody></table><button ng-click="Modals.closeModal(\'newAnalysis\')">Cancel</button></div><form class=form--stacked ng-if=newAnalysis.application ng-submit=run()><h5>Configure run of <em>{{newAnalysis.application.name}}</em> on data set {{newAnalysis.dataSet.id}}</h5><div class=form__group><input type=checkbox id=debug ng-model=newAnalysis.debug>&nbsp;<label for=debug>Generate debug output</label></div><div class=layout><div class=layout__item style="width: 50%"><fieldset><legend>Parameters</legend><div class=form__group ng-repeat="(paramName, param) in newAnalysis.application.parameters"><label>{{param.display_name}}<span ng-if=param.optional>&nbsp;(optional)</span></label><select ng-if=param.value_list ng-required=!param.optional ng-model=newAnalysis.configuration.parameters[paramName] ng-options="value for value in param.value_list"><option value="">-- Choose value --</option></select><input value={{param.value_default}} type=text ng-if="param.config_type === \'str\' && !param.value_list" ng-required=!param.optional ng-model=newAnalysis.configuration.parameters[paramName]> <input value={{param.value_default}} type=number step=1 ng-if="param.config_type === \'int\' && !param.value_list" min={{param.value_min}} max={{param.value_max}} ng-required=!param.optional ng-model=newAnalysis.configuration.parameters[paramName]> <input value={{param.value_default}} type=number step=0.01 ng-if="param.config_type === \'float\' && !param.value_list" min={{param.value_min}} max={{param.value_max}} ng-required=!param.optional ng-model=newAnalysis.configuration.parameters[paramName]></div></fieldset></div><div class=layout__item style="width: 50%"><fieldset><legend>Inputs</legend><div class=form__group ng-repeat="(inputName, input) in newAnalysis.application.inputs"><label>{{input.display_name}} ({{input.sensor_type}})</label><div ng-repeat="multiInput in newAnalysis.configuration.inputs[inputName]" style="position: relative"><select required ng-options="topic for topic in availableSensors[input.sensor_type]" ng-model=newAnalysis.configuration.inputs[inputName][$index]><option value="">-- Choose sensor --</option></select><div class=app-input-delete ng-if="newAnalysis.configuration.inputs[inputName].length > input.count_min" ng-click="deleteInputSensor(inputName, $index)">&times;</div></div><a ng-if="canAddSensor(inputName, input.sensor_type)" ng-click=addInputSensor(inputName)>+ Add sensor</a></div></fieldset></div></div><button type=button ng-click="newAnalysis.application = null">Back</button> <button>Run</button> <button type=button ng-click="Modals.closeModal(\'newAnalysis\')">Cancel</button></form>'),a.put("src/project/new-data-map.tpl.html","<h4>New data map</h4><div class=form__group>Add to data map:<span ng-repeat=\"child in ['site', 'building', 'other']\">&nbsp;<button ng-click=addChild(child)>{{child}}</button></span></div><sensor-container ng-repeat=\"container in newDataMap.map.sensors\" container=container files=dataFiles></sensor-container><form ng-submit=save()><label class=label--inline>Data map name</label>&nbsp; <input class=input--inline required ng-model=newDataMap.name> &nbsp;<button ng-disabled=!newDataMap.valid>Save</button> <button type=button ng-click=\"Modals.closeModal('newDataMap')\">Cancel</button> <small class=\"help help--error\" ng-if=!newDataMap.valid>Add at least one object and sensor to save</small></form>"),a.put("src/project/new-data-set.tpl.html",'<h4>New data set</h4><form ng-submit=save()><div class=form__group><h5>Select data map to use</h5><select required ng-options="dataMap as dataMap.name for dataMap in dataMaps" ng-model=newDataSet.map><option value="">-- Choose data map --</option></select></div><div class=form__group ng-if=newDataSet.map><h5>Select files to use</h5><dl><dt ng-repeat-start="(key, file) in newDataSet.map.map.files">File "{{key}}":</dt><dt><dd ng-repeat-end>Signature:<pre>{{file.signature.headers}}</pre><select required ng-options="file.id as file.file for file in dataFiles | hasSignature:file.signature" ng-model=newDataSet.files[key]><option value="">-- Choose file --</option></select></dd></dt></dl></div><button>Create</button> <button type=button ng-click="Modals.closeModal(\'newDataSet\')">Cancel</button></form>'),a.put("src/project/project.tpl.html",'<div class=container><ul class=breadcrumbs><li><a href=projects>Projects</a></li><li>{{project.name}}</li></ul><div class="view view--project"><h2>{{project.name}}</h2><div class=data-files><h3>Data files</h3><p><label class=label--inline>Upload file</label>&nbsp;<file-upload file-upload-click=upload(fileInput)></file-upload></p><table ng-if=dataFiles.length><thead><tr><th>Name</th><th>Timestamp</th><th>Size</th><th>Download</th><th>Delete</th></tr></thead><tbody><tr ng-repeat="file in dataFiles"><td>{{file.file}}</td><td ng-if=file.timestamp>Configured</td><td ng-if=!file.timestamp><a ng-click=configureTimestamp($index)>Configure</a></td><td>{{file.size | bytes}}</td><td><a href={{file.download_url}} target=_self>Download</a></td><td><a ng-click=deleteFile($index)>Delete</a></td></tr></tbody></table></div><modal class=modal--file-timestamp ng-if="Modals.modalOpen(\'configureTimestamp\')"><ng-include src="\'src/project/configure-timestamp.tpl.html\'" ng-controller=ConfigureTimestampCtrl></ng-include></modal><div class=layout><div class=data-maps><h3>Data maps</h3><p><button ng-click="Modals.openModal(\'newDataMap\')">Create new data map</button></p><table ng-if=dataMaps.length><thead><tr><th>Name</th><th>Delete</th></tr></thead><tbody><tr ng-repeat="dataMap in dataMaps"><td>{{dataMap.name}}</td><td><a ng-click=deleteDataMap($index)>Delete</a></td></tr></tbody></table></div><modal class=modal--new-data-map ng-if="Modals.modalOpen(\'newDataMap\')"><ng-include src="\'src/project/new-data-map.tpl.html\'" ng-controller=NewDataMapCtrl></ng-include></modal><div class=data-sets><h3>Data sets</h3><p><button ng-click="Modals.openModal(\'newDataSet\')">Create new data set</button></p><table ng-if=dataSets.length><thead><tr><th>Name</th><th>Status</th><th>Errors</th><th>Delete</th></tr></thead><tbody><tr ng-repeat="dataSet in dataSets"><td>Data set {{dataSet.id}}</td><td>{{dataSet.status.status || \'Checking&hellip;\' | capitalize}}</td><td ng-if=!dataSet.errors.length>None</td><td ng-if=dataSet.errors.length><a ng-click=showErrors(dataSet)><ng-pluralize count=dataSet.errors.length when="{\'one\': \'1 error\', \'other\': \'{} errors\'}"></ng-pluralize></a></td><td><a ng-click=deleteDataSet($index)>Delete</a></td></tr></tbody></table></div><modal class=modal--data-set-errors ng-if=errorsModal.errors.length><h4>Errors</h4><table><thead><tr><th>Message</th><th>Location</th></tr></thead><tbody><tr ng-repeat="error in errorsModal.errors"><td>{{error.message}}</td><td>{{errorsModal.files[error.file]}}: row {{error.row}}, column {{error.column}}</td></tr></tbody></table><button ng-click="errorsModal.errors = []">Close</button></modal><modal class=modal--new-data-set ng-if="Modals.modalOpen(\'newDataSet\')"><ng-include src="\'src/project/new-data-set.tpl.html\'" ng-controller=NewDataSetCtrl></ng-include></modal></div><div class=analyses><h3>Analyses</h3><p><button ng-click="Modals.openModal(\'newAnalysis\')">Run analysis</button></p><table ng-if=analyses.length><thead><tr><th>Name</th><th>Status</th><th>Report</th></tr></thead><tbody><tr ng-repeat="analysis in analyses"><td ng-if="analysis.status !== \'complete\'">Analysis {{analysis.id}}: {{analysis.name}}</td><td ng-if="analysis.status === \'complete\'"><a ng-click=viewAnalysis(analysis)>Analysis {{analysis.id}}: {{analysis.name}}</a> <span ng-if=analysis.debug>(<a href={{analysis.debug}} target=_self>download debug output</a>)</span></td><td>{{analysis.status | capitalize}}</td><td ng-if="analysis.status === \'complete\' && !(sharedAnalyses | filter:{analysis:analysis.id}).length"><a ng-click=shareAnalysis(analysis)>Share</a></td><td ng-if="(sharedAnalyses | filter:{analysis:analysis.id}).length">Shared (<a ng-click=viewLink(analysis.id)>link</a>)</td></tr></tbody></table></div><modal class=modal--new-analysis ng-if="Modals.modalOpen(\'newAnalysis\')"><ng-include src="\'src/project/new-analysis.tpl.html\'" ng-controller=NewAnalysisCtrl></ng-include></modal><modal class=modal--analysis ng-if="Modals.modalOpen(\'viewAnalysis\')"><h4>{{viewingAnalysis.name}}</h4><analysis-report ng-repeat="report in viewingAnalysis.reports" ar-report=report ar-data=viewingAnalysisData></analysis-report><button ng-click="Modals.closeModal(\'viewAnalysis\')">Close</button></modal><modal class=modal--view-link ng-if="Modals.modalOpen(\'viewLink\')"><p><a href={{viewingLink.url}}>{{viewingLink.url}}</a></p><button ng-click=revokeLink(viewingLink)>Revoke</button> <button ng-click="Modals.closeModal(\'viewLink\')">Close</button></modal></div></div>'),a.put("src/projects/projects.tpl.html",'<div class=container><ul class=breadcrumbs><li>Projects</li></ul><div class="view view--projects"><h2>Projects</h2><ul ng-if=projects.length><li ng-repeat="project in projects"><a ng-href=projects/{{project.id}}>{{project.name}}</a> &mdash; <a ng-click=renameProject($index)>Rename</a> &mdash; <a ng-click=deleteProject($index)>Delete</a> &mdash; <a ng-click=cloneProject($index)>Clone</a></li></ul><form ng-submit=newProject.create()><label class=label--inline>Create new project</label>&nbsp; <input class=input--inline type=text placeholder=Name ng-model=newProject.name required> &nbsp;<button type=submit>Create</button></form></div></div>'),a.put("src/recovery/recovery.tpl.html",'<div class=container><div class="view view--recovery"><h1><a href="/">OpenEIS</a></h1><form class=panel ng-submit=submit()><h2>Recover account</h2><div class=form__group ng-if="form.stage === 1"><label for=recoveryId>Username or email address</label><input id=recoveryId type=text required ng-change=clearError() ng-trim=false ng-model=recovery.id></div><div class=form__group ng-if="form.stage === 2"><label>Username</label><input type=text disabled ng-model=recovery.username></div><div class=form__group ng-if="form.stage === 2"><label for=password>New password</label><input id=password type=password required ng-trim=false ng-model=recovery.password><br><label for=password>Confirm new password</label><input type=password required ng-trim=false ng-model=recovery.passwordConfirm></div><div class=form__group ng-if=form.stage><button type=submit>Submit</button></div><div class="alert alert--success" ng-if=form.success>{{form.success}}</div><div class="alert alert--error" ng-if=form.error ng-switch=form.error.status><span ng-switch-when=400>{{form.error.data}}</span> <span ng-switch-when=404>{{form.error.data}}</span> <span ng-switch-default>Unknown error occurred. ({{form.error}})</span></div></form></div></div>'),a.put("src/shared-analyses/shared-analyses.tpl.html",'<div class=container><div class="view view--shared-analysis" ng-if=valid><h1>{{sharedAnalysis.name}}</h1><analysis-report ng-repeat="report in sharedAnalysis.reports" ar-report=report ar-data=data></analysis-report></div><p ng-if=!valid>Invalid shared analysis link.</p></div>'),a.put("src/signup/signup.tpl.html",'<div class=container><div class="view view--signup"><h1>OpenEIS</h1><form class=panel ng-submit=submit()><h2>Get an account</h2><div class=form__group><label for=name>Name</label><input id=name type=text ng-model=account.first_name> <small class="help help--error" ng-if=form.error.data.first_name>{{form.error.data.first_name}}</small></div><div class=form__group><label for=email>Email address</label><input id=email type=email required ng-change="form.error.data.email = false" ng-model=account.email> <small class="help help--error" ng-if=form.error.data.email>{{form.error.data.email}}</small></div><div class=form__group><label for=username>Username</label><input id=username type=text autocomplete=off required ng-change="form.error.data.username = false" ng-model=account.username> <small class="help help--error" ng-if=form.error.data.username>{{form.error.data.username}}</small></div><div class=form__group><label for=password>Password</label><input id=password type=password autocomplete=off required ng-trim=false ng-change="form.error.data.password = false; form.passwordConfirm = false" ng-model=account.password> <small class="help help--error" ng-if=form.error.data.password>{{form.error.data.password}}</small><br><label for=passwordConfirm>Confirm password</label><input id=passwordConfirm type=password autocomplete=off required ng-trim=false ng-change="form.passwordConfirm = false" ng-model=account.passwordConfirm> <small class="help help--error" ng-if=form.passwordConfirm>{{form.passwordConfirm}}</small></div><div class=form__group><button type=submit>Sign up</button></div><div class="alert alert--error" ng-if="form.error.status && form.error.status !== 400">Unknown error occurred. ({{form.error.status}})</div></form></div></div>')
}]);